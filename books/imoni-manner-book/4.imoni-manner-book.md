---
title: "'use strict' 厳格モードの話"
---
# 'use strict'を書く理由を理解しておこう！
![](https://storage.googleapis.com/zenn-user-upload/6a2add633a7801c2d07aa059.png)

## いつも書いてるおまじないの1行
kintoneでJavaScriptを使ってカスタマイズコードを書いている時に、一番最初の行に書くことの多い`use strict`。皆さんはどのくらい意識してこの1行を書いていますか？

## そもそも、Strictモード(厳格モード)とは？
> Strictモードを使用すると、通常のJavaScriptの意味にいくつかの変更を加えます。エラーではないが落とし穴になる一部の事柄を、エラーが発生するように変更することで除去します。
>1. JavaScriptエンジンによる最適化処理を困難にする誤りを修正します。
>2. Strictモードのコードは、非Strict モードのコードより高速に実行できる可能性があります。
>3. 将来のECMAScriptで定義される予定の構文の使用を禁止します。
>
>[Strict モード](https://developer.mozilla.org/ja/docs/Web/JavaScript/Reference/Strict_mode)

つまり、`use strict` は事前にコードをチェックし、ミスを防ぐことに役立つおまじないの1行です。

さらに詳しく、どの様なコードをチェックしているのか確認したい方は、以下で紹介する「特徴」の内容を読んでみてください。

### 具体例
Strictモードを利用しなかった場合と、利用した場合にどのような違いがあるのか確認してみましょう。

#### `'use strict'` を利用していない場合
![](https://storage.googleapis.com/zenn-user-upload/8616a43f7c2d3ef28cebf44a.png)
`text_a`は、グローバル変数として処理され`console.log(text_a);`が実行される。

※「なぜグローバル変数がいけないの？と」思った方は
[グローバル変数を乱用しない](https://kenju.gitbooks.io/js_step-up-to -intermediate/content/content/part01/avoid_abusing_global_variables.html)を一読してみてください。

#### `'use strict'` を利用した場合
![](https://storage.googleapis.com/zenn-user-upload/dbda84b8378ce0a20f41aaf2.png)

`ReferenceError: text_b is not defined`
参照エラー: text_bが定義されていないため、エラーが返される。

`let`を利用して、変数を定義してから実行してみましょう。
![](https://storage.googleapis.com/zenn-user-upload/b80dfa2b7399ab3dc5576595.png)
正しく、実行することができました。

このように`'use strict'`を利用すると開発途中で、
エラーになる一部を教えてくれるため、コードを素早く修正できます。

「Strictモードを使うと、デバッグが捗りそうで良いね！」と思えましたか？

## Strictモードのスコープ
次は、Strictモードのスコープを紹介します。スコープというのは範囲を示しています。

Strictモードをスクリプト全体、または、個別の関数に絞って適用す流のか使い分けてみましょう。冒頭で記載した「一番最初の行に書くことの多い`use strict`」というのは、コード全体にStrictモードを適用しています。

```js:全体にStrictモード
'use strict';
var text = "こんにちは！Strictモードのスクリプト！";
```

```js:関数のみStrictモード
function strict() {
  // 関数レベルの Strict モード構文
  'use strict';
  return "こんにちは！ Strict モードの関数です！";
}
```

`function`の中に`'use strict';`が定義されている。
つまり、

```js:関数のみStrictモード
function strict() {
  // 関数レベルの Strict モード構文
  'use strict';
  return "こんにちは！ Strict モードの関数です！";
}

function non_strict() {
  return "こちらは、Strictモードではありません！";
}
```

Strictモードの関数と、非Strictモードの関数を書くことができます。
これは、既存のコードとの兼ね合いを考えて利用すると良いでしょう。

:::message
関数をexportしてモジュールとして利用する場合は、
Strictモードの宣言の有無に拘らずStrict モードで動作します。
:::

## 特徴
:::details 1.ミスをエラーとして返す
```js
(() => {
  'use strict';
  mistypeVariable = 17;
})();
```

```
$ node strict-sample.js

/Ducuments/strict-sample.js:3
  mistypeVariable = 17;
                  ^

ReferenceError: mistypeVariable is not defined
```
:::


:::details 2.例外を発生させる
```js
(() => {
  'use strict';
  // 書き換え不可能なグローバルへの代入
  undefined = 5; // TypeError を投げます
})();
```

```
$ node strict-sample.js

/Documents/strict-sample.js:4
  undefined = 5; // TypeError を投げます
            ^

TypeError: Cannot assign to read only property 'undefined' of object '#<Object>'
```
:::

:::details 3.削除できないプロパティの削除操作に対してエラー
```js
(() => {
  'use strict';
  delete Object.prototype; // TypeError を投げます
})();
```

```
$ node strict-sample.js
/Documents/strict-sample.js:3
  delete Object.prototype; // TypeError を投げます
  ^

TypeError: Cannot delete property 'prototype' of function Object() { [native code] }
```
:::

:::details 4.関数の引数名が一意であることを必須
```js
(() => {
  'use strict';
  function sum(a, a, c) { // !!! 構文エラー
    'use strict';
    return a + a + c; // このコードが実行されると
  }
})();
```

```
$ node strict-sample.js
/Document/strict-sample.js:3
  function sum(a, a, c) { // !!! 構文エラー
                  ^
SyntaxError: Duplicate parameter name not allowed in this context
```
:::

:::details 5.プリミティブ値にプロパティを設定することが禁止

プリミティブ値 = メソッドを持たないデータのこと。
イミュータブルimmutable、変更できない値のこと。

(例)
`'テスト'.length`
-> 3
`primitiveValue.length` 
-> 不可能

```js
(() => {
  'use strict';
  false.true = '';         // TypeError
  (14).sailing = 'home';   // TypeError
  'with'.you = 'far away'; // TypeError
})();
```

```
$ node strict-sample.js

false.true = '';         // TypeError
             ^

TypeError: Cannot create property 'true' on boolean 'false'

---

(14).sailing = 'home';   // TypeError
               ^

TypeError: Cannot create property 'sailing' on number '14'

---

'with'.you = 'far away'; // TypeError
             ^

TypeError: Cannot create property 'you' on string 'with'
```
:::

## メリット
- エラーになる一部を教えてくれる
- プログラムを高速に実行できる
- セキュアなJavaScriptコード記述


## 注意点
- Strictモードは、全てのブラウザでサポートされていない
- ブラウザのバージョンによっても異なる
	- https://caniuse.com/?search=use%20strict

## まとめ
結論: `use strict` はエラー該当箇所を事前に確認することができ、セキュアなコーディングができるため記載しよう。

使い分け
- カスタマイズファイル数が少ない時は 全体スコープで`use strict` を記載することをお勧めします。
- 複数のファイルを連携させる複雑なカスタマイズになった際は、Strictモード有無が混在する可能性があるため、特定の関数のみに`use strict` を利用する等、Strictモードのスコープを検討した方が良さそうです。

## チェックポイント
- [x] kintoneカスタマイズの際に、`'use strict';`を書いている意図がわかった
- [x] `'use strict';`のスコープがわかった